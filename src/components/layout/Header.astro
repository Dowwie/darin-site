---
import Search from "@/components/Search.astro";
import ThemeToggle from "@/components/ThemeToggle.astro";
import { menuLinks } from "@/site.config";
import { siteConfig } from "../../site.config";
---

<header class="group relative mb-12" id="main-header">
	{/* ANSI Art Banner */}
	<a href="/" class="block mb-6 hover:opacity-90 transition-opacity">
		<div class="font-mono text-[8px] sm:text-[10px] md:text-xs leading-none overflow-x-auto whitespace-pre select-none">
<pre class="text-[var(--color-accent-2)]">  ██████╗  ██████╗ ███╗   ██╗███████╗ ██████╗
 ██╔════╝ ██╔═══██╗████╗  ██║╚══███╔╝██╔═══██╗
 ██║  ███╗██║   ██║██╔██╗ ██║  ███╔╝ ██║   ██║
 ██║   ██║██║   ██║██║╚██╗██║ ███╔╝  ██║   ██║
 ╚██████╔╝╚██████╔╝██║ ╚████║███████╗╚██████╔╝
  ╚═════╝  ╚═════╝ ╚═╝  ╚═══╝╚══════╝ ╚═════╝</pre>
<pre class="text-[var(--color-accent)]"> ███████╗███╗   ██╗ ██████╗ ██╗███╗   ██╗███████╗███████╗██████╗ ██╗███╗   ██╗ ██████╗
 ██╔════╝████╗  ██║██╔════╝ ██║████╗  ██║██╔════╝██╔════╝██╔══██╗██║████╗  ██║██╔════╝
 █████╗  ██╔██╗ ██║██║  ███╗██║██╔██╗ ██║█████╗  █████╗  ██████╔╝██║██╔██╗ ██║██║  ███╗
 ██╔══╝  ██║╚██╗██║██║   ██║██║██║╚██╗██║██╔══╝  ██╔══╝  ██╔══██╗██║██║╚██╗██║██║   ██║
 ███████╗██║ ╚████║╚██████╔╝██║██║ ╚████║███████╗███████╗██║  ██║██║██║ ╚████║╚██████╔╝
 ╚══════╝╚═╝  ╚═══╝ ╚═════╝ ╚═╝╚═╝  ╚═══╝╚══════╝╚══════╝╚═╝  ╚═╝╚═╝╚═╝  ╚═══╝ ╚═════╝</pre>
		</div>
	</a>

	{/* Navigation Bar */}
	<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 py-3 border-y border-[var(--color-border)]">
		{/* Navigation */}
		<nav
			aria-label="Main menu"
			class="bg-[var(--color-global-bg)] sm:bg-transparent absolute -inset-x-4 top-32 hidden flex-col border border-[var(--color-border)] p-4 group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:flex sm:flex-row sm:items-center sm:gap-1 sm:border-0 sm:p-0"
			id="navigation-menu"
		>
			{
				menuLinks.map((link, index) => (
					<a
						aria-current={Astro.url.pathname === link.path ? "page" : false}
						class:list={[
							"relative px-3 py-2 text-sm font-medium transition-all duration-200",
							"hover:text-[var(--color-accent)] hover:bg-[var(--color-accent)]/10",
							Astro.url.pathname === link.path
								? "text-[var(--color-accent)]"
								: "text-[var(--color-global-text)]"
						]}
						href={link.path}
					>
						<span class="text-[var(--color-muted)] mr-1">{index + 1}.</span>
						{link.title}
					</a>
				))
			}
		</nav>

		{/* Controls */}
		<div class="flex items-center gap-3">
			<Search />
			<ThemeToggle />
			<mobile-button>
				<button
					aria-expanded="false"
					aria-haspopup="menu"
					class="group relative ms-2 h-8 w-8 flex items-center justify-center border border-[var(--color-border)] hover:border-[var(--color-accent)] transition-colors sm:hidden"
					id="toggle-navigation-menu"
					type="button"
				>
					<span class="sr-only">Open main menu</span>
					<svg
						aria-hidden="true"
						class="h-4 w-4 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
						fill="none"
						focusable="false"
						stroke="currentColor"
						stroke-width="1.5"
						viewBox="0 0 24 24"
						xmlns="http://www.w3.org/2000/svg"
					>
						<path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
					</svg>
					<svg
						aria-hidden="true"
						class="text-[var(--color-accent)] absolute h-4 w-4 scale-0 opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
						fill="none"
						focusable="false"
						stroke="currentColor"
						stroke-width="1.5"
						viewBox="0 0 24 24"
						xmlns="http://www.w3.org/2000/svg"
					>
						<path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
					</svg>
				</button>
			</mobile-button>
		</div>
	</div>
</header>

<script>
	import { toggleClass } from "@/utils/domElement";

	class MobileNavBtn extends HTMLElement {
		#menuOpen: boolean = false;

		connectedCallback() {
			const headerEl = document.getElementById("main-header")!;
			const mobileButtonEl = this.querySelector<HTMLButtonElement>("button");

			mobileButtonEl?.addEventListener("click", () => {
				if (headerEl) toggleClass(headerEl, "menu-open");
				this.#menuOpen = !this.#menuOpen;
				mobileButtonEl.setAttribute("aria-expanded", this.#menuOpen.toString());
			});
		}
	}

	customElements.define("mobile-button", MobileNavBtn);
</script>
