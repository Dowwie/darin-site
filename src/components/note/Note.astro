---
import { type CollectionEntry, render } from "astro:content";
import FormattedDate from "@/components/FormattedDate.astro";
import type { HTMLTag, Polymorphic } from "astro/types";

type Props<Tag extends HTMLTag> = Polymorphic<{ as: Tag }> & {
	note: CollectionEntry<"note">;
	isPreview?: boolean | undefined;
};

const { as: Tag = "div", note, isPreview = false } = Astro.props;
const { Content } = await render(note);
---

<article
	class:list={[
		isPreview && "border border-[var(--color-border)] bg-[var(--color-global-bg)]/50 px-4 py-4 hover:border-[var(--color-quote)]/50 transition-colors"
	]}
	data-pagefind-body={isPreview ? false : true}
>
	<div class="flex items-start justify-between gap-4 mb-2">
		<Tag class:list={["font-medium", isPreview ? "text-base" : "text-xl text-[var(--color-accent-2)]"]}>
			{
				isPreview ? (
					<a class="text-[var(--color-global-text)] hover:text-[var(--color-quote)] transition-colors" href={`/notes/${note.id}/`}>
						{note.data.title}
					</a>
				) : (
					<>{note.data.title}</>
				)
			}
		</Tag>
		<FormattedDate
			class="text-xs font-mono text-[var(--color-muted)] shrink-0"
			dateTimeOptions={{
				hour: "2-digit",
				minute: "2-digit",
				year: "2-digit",
				month: "2-digit",
				day: "2-digit",
			}}
			date={note.data.publishDate}
		/>
	</div>
	<div
		class="prose prose-sm prose-cactus max-w-none text-[var(--color-muted)] [&>p:last-of-type]:mb-0"
		class:list={{ "line-clamp-3": isPreview }}
	>
		<Content />
	</div>
</article>
